<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Cart - VivaSmart</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    .cart-item img {
      width: 100px;
      height: auto;
      object-fit: cover;
    }
    .cart-summary {
      font-size: 1.2rem;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
    <a class="navbar-brand" href="index.html">VivaSmart</a>
    <div class="ms-auto d-flex align-items-center text-white">
      <span id="user-name" class="me-2"></span> | 
      <span id="user-email" class="mx-2"></span>
      <a href="cart.html" class="text-white ms-3">
        <i class="fas fa-shopping-cart"></i> Cart (<span id="cart-count">0</span>)
      </a>
      <button id="logout-btn" class="btn btn-sm btn-outline-light ms-3">Logout</button>
    </div>
  </nav>

  <!-- Cart Items -->
  <div class="container my-5">
    <h2 class="mb-4">Shopping Cart</h2>
    <div id="cartItems" class="row gy-4"></div>

    <div class="text-end mt-4 cart-summary">
      Total: ₦<span id="cartTotal">0</span>
    </div>

    <div class="text-end mt-3">
      <a href="checkout.html" class="btn btn-success">Proceed to Checkout</a>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Cart & User JS -->
  <script>
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
      document.getElementById("cart-count").textContent = totalItems;
    }

    function displayUserInfo() {
      const user = JSON.parse(localStorage.getItem("user")) || null;
      if (user) {
        document.getElementById("user-name").textContent = user.username || "Guest";
        document.getElementById("user-email").textContent = user.email || "";
      } else {
        document.getElementById("user-name").textContent = "Guest";
        document.getElementById("user-email").textContent = "";
      }
    }

    function logoutUser() {
      localStorage.removeItem("user");
      localStorage.removeItem("cart");
      window.location.href = "login.html";
    }

    function renderCart() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const cartItemsContainer = document.getElementById("cartItems");
      const cartTotalEl = document.getElementById("cartTotal");

      cartItemsContainer.innerHTML = "";
      let total = 0;

      cart.forEach((item, index) => {
        const itemTotal = item.price * (item.quantity || 1);
        total += itemTotal;

        const itemHTML = `
          <div class="col-12 cart-item border rounded p-3 d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
              <img src="${item.image}" alt="${item.name}" class="me-3" />
              <div>
                <h5>${item.name}</h5>
                <p>₦${item.price.toLocaleString()}</p>
                <div>
                  Qty:
                  <input type="number" min="1" value="${item.quantity || 1}" data-index="${index}" class="form-control d-inline-block" style="width: 70px;" onchange="updateQuantity(this)">
                </div>
              </div>
            </div>
            <button class="btn btn-danger" onclick="removeItem(${index})"><i class="fas fa-trash"></i></button>
          </div>
        `;
        cartItemsContainer.innerHTML += itemHTML;
      });

      cartTotalEl.textContent = total.toLocaleString();
      updateCartCount();
    }

    function updateQuantity(input) {
      const index = input.dataset.index;
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      cart[index].quantity = parseInt(input.value);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart(); // re-render & update cart count instantly
    }

    function removeItem(index) {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      cart.splice(index, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart(); // re-render & update cart count instantly
    }

    // Init
    document.addEventListener("DOMContentLoaded", () => {
      renderCart();
      displayUserInfo();
      document.getElementById("logout-btn").addEventListener("click", logoutUser);
    });
  </script>
</body>
</html>
